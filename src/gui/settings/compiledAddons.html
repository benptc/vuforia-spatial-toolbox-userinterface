<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    <title>Spatial Toolbox - Compiled Add-ons</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">

    <!-- Include the compiled Ratchet CSS -->
    <link href="../../../thirdPartyCode/css/ratchet.css" rel="stylesheet">
    <link href="../../../thirdPartyCode/css/ratchet-theme-ios.css" rel="stylesheet">

    <!-- Include the compiled Ratchet JS -->
    <script src="../../../thirdPartyCode/js/ratchet.min.js"></script>
</head>

<body style="background-color: #efeff4;">

<div style="position: absolute; right: 0; width: 65px; top:0; bottom: 0; background-color: #222222"></div>
<div>
    <header class="bar bar-nav" style="right:65px; left:0">
        <a href="develop.html" data-ignore="push">
            <button class="btn btn-link btn-nav pull-left" style="user-select: none; -webkit-user-select: none">
                <span class="icon icon-left-nav"></span>
                Back
            </button></a>
        <div class="title">Compiled Add-ons</div>
    </header>

    <!-- Wrap all non-bar HTML in the .content div (this is actually what scrolls) -->
    <div class="content" style="right:65px;">
        <div class="card">
            <ul class="table-view" id="addonsList"></ul>
        </div>
    </div>

    <template id="tableEntry">
        <li class="table-view-cell table-view-cell"></li>
    </template>
</div>

<script>
    // because this is a self-contained iframe, only way to receive data about found objects is using a message listener
    window.addEventListener("message", function (e) {
        var msg = JSON.parse(e.data);
        if (msg.addonsList) {
            console.log('got add-ons list: ' + msg.addonsList);
            populateAddonsList(msg.addonsList);
        }
    });

    // create a new row for each add-on
    function populateAddonsList(addonNames) {
        document.getElementById("addonsList").innerHTML = '';
        addonNames.forEach(function(name) {
            addEntry(name);
        });
    }

    // build the HTML element for this add-on
    function addEntry(addonName) {
        var tableEntry = document.getElementsByTagName('template')['tableEntry'].content.cloneNode(true);
        let tableEntryContents = tableEntry.querySelector('.table-view-cell');
        tableEntryContents.innerText = addonName;
        document.getElementById("addonsList").appendChild(tableEntry);
    }

    // ask the main application for the list of add-ons it has
    parent.postMessage(JSON.stringify({getAddonsList: true}), "*");
</script>

</body>
</html>
